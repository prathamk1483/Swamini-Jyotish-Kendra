<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jyotish Karyalay - Document Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@400;600;700&family=Noto+Sans+Devanagari:wght@400;600;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #0A2E4B;
            --accent-green: #187A22;
            --border-color: #D3D9DE;
            --bg-color: #F8F9FA;
            --text-dark: #212529;
            --text-muted: #6C757D;
            --sidebar-bg: #2C3E50;
        }

        body { font-family: 'Mukta', 'Noto Sans Devanagari', sans-serif; margin: 0; padding: 0; background-color: #e9ecef; color: var(--text-dark); -webkit-print-color-adjust: exact; print-color-adjust: exact; display: flex; height: 100vh; overflow: hidden; }

        /* --- SIDEBAR --- */
        .sidebar { width: 340px; background-color: var(--sidebar-bg); color: white; padding: 20px; box-shadow: 2px 0 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; z-index: 10; overflow-y: auto; }
        .sidebar h2 { margin-top: 0; font-size: 20px; border-bottom: 1px solid #455A64; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 14px; color: #B0BEC5; }
        .form-group input:not([type="checkbox"]), .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #455A64; border-radius: 4px; background-color: #34495E; color: white; font-size: 15px; box-sizing: border-box; font-family: inherit; }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-group input[type="time"]::-webkit-calendar-picker-indicator, .form-group input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }

        .print-btn { margin-top: 15px; margin-bottom: 20px; background-color: #F47A20; color: white; border: none; padding: 15px; font-size: 16px; font-weight: bold; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; width: 100%; }
        
        .btn-add { background-color: #28a745; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 5px; }
        .btn-undo { background-color: #ffc107; color: #212529; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 5px; }
        .btn-clear { background-color: #dc3545; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 20px; }

        /* --- SIMPLE CHECKLIST STYLES --- */
        .checkbox-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 25px; }
        .checkbox-item { display: flex; align-items: center; gap: 10px; font-size: 15px; color: white; cursor: pointer; user-select: none; }
        .checkbox-item input { cursor: pointer; width: 16px; height: 16px; margin: 0; flex-shrink: 0; accent-color: #28a745; }

        /* --- WORKSPACE & GLOBAL PAGE STYLES --- */
        .main-workspace { flex: 1; padding: 40px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; gap: 40px;}
        /* Updated page-container to flex column to push footer to bottom if content is short */
        .page-container { width: 850px; background: white; padding: 30px 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 8px; box-sizing: border-box; flex-shrink: 0; display: flex; flex-direction: column; }
        
        /* --- GLOBAL HEADER --- */
        .page-header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 2px solid var(--primary-blue); padding-bottom: 12px; margin-bottom: 15px; }
        .header-title .main-heading { font-size: 26px; color: var(--primary-blue); margin: 0; }
        .header-contact { text-align: left; margin-left:-50px;}
        .logo-area { text-align: center;display: flex; align-items: center; justify-content: flex-start; font-size: 20px; font-weight: 700; color: var(--primary-blue);z-index: 10; }
        .contact-details { font-size: 14px; color: var(--text-dark); line-height: 1.4; }
        .contact-details strong { color: var(--primary-blue); }
        .logo{height: 100px;width: 100px;}

        .box { border: 1px solid var(--border-color); border-radius: 6px; background: white; margin-bottom: 12px; padding: 12px; page-break-inside: avoid; }
        .info-box { text-align: center; background-color: #fafbfc; }
        .info-row-1 { font-size: 18px; margin-bottom: 5px; }
        .info-row-1 strong { color: var(--primary-blue); }
        .info-row-2 { font-size: 18px; color: var(--primary-blue); }

        .summary-box { display: flex; justify-content: space-between; align-items: center; padding: 0px 30px; background-color: #fafbfc; }
        .summary-item { text-align: center; }
        .rashi-title { font-size: 20px; font-weight: bold; color: var(--accent-green); }
        .lagna-title { font-size: 16px; color: var(--accent-green); margin-top: 5px; }
        .summary-center h3 { margin: 0 0 5px 0; font-size: 20px; color: var(--accent-green); }
        .summary-center p { margin: 0; font-size: 14px; color: var(--accent-green); }
        .mangal-dosh { font-weight: bold; font-size: 18px; }

        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 12px; }
        .detail-card { padding: 10px; background-color: #fafbfc; display: flex; justify-content: center; }
        
        .detail-table { border-collapse: collapse; width: 100%; }
        .detail-table td { padding: 4px 10px; font-size: 15px; vertical-align: middle; }
        .detail-table td:first-child { text-align: right; color: var(--text-dark); width: 50%; border-right: 1px solid transparent; }
        .detail-table td:last-child { color: var(--accent-green); font-weight: 500; text-align: left; }

        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 15px; background-color: #fafbfc; }
        
        .chart-container { display: flex; align-items: center; justify-content: center; height: 100%; }
        .svg-chart { width: 100%; height: auto; max-width: 310px; display: block; }
        .chart-lines { stroke: #a0aab5; stroke-width: 1; fill: none; }
        .chart-num { font-size: 11px; fill: #6C757D; font-weight: bold; }
        .chart-planet { font-size: 13px; fill: var(--primary-blue); font-weight: 600; }

        .planet-table-section h3 { margin-top: 0; color: var(--primary-blue); font-size: 18px; margin-bottom: 8px; }
        .planet-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .planet-table th { text-align: left; padding-bottom: 6px; color: var(--text-dark); font-weight: 600; }
        .planet-table td { padding: 2px 0; color: var(--text-dark); } 
        .planet-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 5px; vertical-align: middle; }
        .dot-sun { background: #F47A20; } .dot-moon { background: #95A5A6; } .dot-merc { background: #7F8C8D; } .dot-ven { background: #F1C40F; } .dot-mars { background: #E74C3C; } .dot-jup { background: #A0522D; } .dot-sat { background: #7A8498; } .dot-node { background: transparent; }
        .footer-note { margin-top: 0px; font-size: 10px; color: var(--primary-blue); }
        
        .planet-suffix { font-weight: bold; color: var(--primary-blue); margin-left: 2px; }

        /* --- PAGE 2 SPECIFIC STYLES --- */
        .page-2-header { background-color: var(--primary-blue); color: white; margin: 0; padding: 8px; text-align: center; font-size: 18px; border-radius: 4px 4px 0 0; }
        
        .dasha-row { border-bottom: 1px solid #eaedf0; }
        .dasha-row:last-child { border-bottom: none; }
        .dasha-row td { padding: 8px 12px; font-size: 15px; }
        .dasha-row td:first-child { font-weight: bold; color: var(--accent-green); width: 30%; border-right: 1px solid #eaedf0; background: #fafbfc;}
        .dasha-row td:last-child { text-align: center; color: var(--text-dark); font-weight: 600; }
        
        .ratna-box { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 15px; box-sizing: border-box; background: #fffdf5; border: 2px dashed #f1c40f;}

        .mantra-row td { padding: 5px 10px; font-size: 13px; }
        .mantra-row td:first-child { font-weight: bold; color: var(--primary-blue); font-size: 15px; width: 22%; text-align: center; }
        .mantra-row td:nth-child(2) { text-align: center; font-weight: bold; color: var(--accent-green); font-size: 15px; }
        .mantra-row td:last-child { text-align: center; font-weight: normal; color: var(--text-dark); font-size: 13px; width: 22%; background: #fafbfc; border-left: 1px solid #eaedf0; }

        /* --- PAGE 3 (FALA SHRUTI) STYLES --- */
        .editable-textarea { width: 100%; min-height: 600px; padding: 20px; font-size: 18px; line-height: 1.8; border: none; outline: none; white-space: pre-wrap; color: var(--text-dark); }
        .editable-textarea:empty:before { content: attr(data-placeholder); color: #B0BEC5; font-style: italic; }

        /* --- NEW FOOTER STYLES --- */
        .page-footer {
            margin-top: auto; /* Pushes to bottom within flex container */
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 13px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .footer-logo {
            height: 22px;
            width: auto;
            vertical-align: middle;
        }
        .orconix-text {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: var(--primary-blue);
        }

        @media (max-width: 850px) {
            body { flex-direction: column; height: auto; overflow: auto; }
            .sidebar { width: 100%; box-sizing: border-box; padding: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
            .main-workspace { padding: 10px; width: 100%; box-sizing: border-box; gap: 20px; }
            .page-container { width: 100%; padding: 15px; height: auto; }
            .page-header { flex-direction: column; text-align: center; align-items: center; gap: 15px; }
            .header-contact { text-align: center; margin-left: 0; }
            .logo-area { justify-content: center; }
            .details-grid, .main-content { grid-template-columns: 1fr; }
            .summary-box { flex-direction: column; gap: 5px; }
            .detail-table td:first-child { text-align: left; }
            #page2Grid { grid-template-columns: 1fr !important; }
        }

        /* --- PRINT STYLES --- */
        @media print {
            @page { size: A4 portrait; margin: 5mm; }
            body { background: white; display: block; height: auto; overflow: visible; margin: 0; }
            .sidebar { display: none !important; }
            .main-workspace { padding: 0; display: block; height: auto; overflow: visible; gap: 0; }
            .page-container { 
                box-shadow: none; padding: 5px 20px !important; width: 100% !important; max-width: 100% !important; border: none;
                transform: scale(0.97); transform-origin: top center; margin-bottom: 0; page-break-after: always;
                height: 100%; /* Ensure it fills the printed page height for footer placement */
                display: flex; flex-direction: column;
            }
            /* Ensure main content expands to fill printed page so footer sits at bottom */
            .page-container > *:not(.page-header):not(.page-footer) {
                 flex-shrink: 0;
            }
            
            .page-header { display: flex !important; flex-direction: row !important; text-align: left !important; align-items: flex-end !important; justify-content: space-between !important; }
            .header-contact { text-align: left !important; margin-left: -50px !important; }
            .logo-area { justify-content: flex-start !important; }

            .page-2, .page-3 { page-break-before: always; padding-top: 20px !important; page-break-after: auto; }
            .box { border-color: #000; }
            .details-grid, .main-content { grid-template-columns: 1fr 1fr !important; display: grid !important; }
            .summary-box { flex-direction: row !important; display: flex !important; }
            .detail-table td:first-child { text-align: right !important; }
            #page2Grid { grid-template-columns: 1fr 1fr !important; display: grid !important; }
            .editable-textarea:empty:before { content: ""; }
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <h2>ग्राहक तपशील</h2>
        <div class="form-group"><label>पूर्ण नाव</label><input type="text" id="clientNameInput" value="Amey Hatekar"></div>
        
        <div class="form-group" style="margin-bottom: 5px;"><label>जन्मस्थान</label><input type="text" id="clientPlaceInput" value="Amravati, India"></div>
        
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <div class="form-group" style="margin-bottom: 0; flex: 1;"><label>अक्षांश (Lat)</label><input type="number" step="0.01" id="clientLatInput" value="20.93"></div>
            <div class="form-group" style="margin-bottom: 0; flex: 1;"><label>रेखांश (Lon)</label><input type="number" step="0.01" id="clientLonInput" value="77.75"></div>
        </div>

        <div class="form-group" style="margin-bottom: 8px;">
            <label>दशा भोग्य ग्रह व काळ</label>
            <select id="bhogyaPlanetInput" style="margin-bottom: 10px;">
                <option value="सूर्य">सूर्य</option><option value="चन्द्र">चन्द्र</option><option value="मंगल">मंगल</option>
                <option value="बुध" selected>बुध</option><option value="गुरु">गुरु</option><option value="शुक्र">शुक्र</option>
                <option value="शनि">शनि</option><option value="राहू">राहू</option><option value="केतु">केतु</option>
            </select>
        </div>
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <div class="form-group" style="margin-bottom: 0; flex: 1;"><label>वर्षे (y)</label><input type="number" id="bhogyaYInput" value="10" min="0"></div>
            <div class="form-group" style="margin-bottom: 0; flex: 1;"><label>महिने (m)</label><input type="number" id="bhogyaMInput" value="3" min="0"></div>
            <div class="form-group" style="margin-bottom: 0; flex: 1;"><label>दिवस (d)</label><input type="number" id="bhogyaDInput" value="13" min="0"></div>
        </div>
        
        <div class="form-group" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #455A64;">
            <label class="checkbox-item" style="font-size: 15px;">
                <input type="checkbox" id="mangalDoshInput"> मंगळ दोष आहे? (Has Mangal Dosh)
            </label>
        </div>

        <div class="form-group"><label>जन्म तारीख</label><input type="date" id="clientDateInput" value="1998-04-25"></div>
        <div class="form-group"><label>जन्म वेळ</label><input type="time" id="clientTimeInput" value="09:09"></div>

        <h2 style="margin-top: 15px; border-bottom: 1px solid #455A64; padding-bottom: 10px;">पंचांग तपशील</h2>
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <div class="form-group" style="margin-bottom: 0; flex: 1.2;">
                <label>वार</label>
                <select data-control="PanchangDay">
                    <option value="रविवार">रविवार</option><option value="सोमवार">सोमवार</option>
                    <option value="मंगळवार">मंगळवार</option><option value="बुधवार">बुधवार</option>
                    <option value="गुरुवार">गुरुवार</option><option value="शुक्रवार">शुक्रवार</option>
                    <option value="शनिवार" selected>शनिवार</option>
                </select>
            </div>
            <div class="form-group" style="margin-bottom: 0; flex: 1.2;">
                <label>महिना</label>
                <select data-control="PanchangMonth">
                    <option value="चैत्र" selected>चैत्र</option><option value="वैशाख">वैशाख</option>
                    <option value="ज्येष्ठ">ज्येष्ठ</option><option value="आषाढ">आषाढ</option>
                    <option value="श्रावण">श्रावण</option><option value="भाद्रपद">भाद्रपद</option>
                    <option value="आश्विन">आश्विन</option><option value="कार्तिक">कार्तिक</option>
                    <option value="मार्गशीर्ष">मार्गशीर्ष</option><option value="पौष">पौष</option>
                    <option value="माघ">माघ</option><option value="फाल्गुन">फाल्गुन</option>
                </select>
            </div>
            <div class="form-group" style="margin-bottom: 0; flex: 1;">
                <label>वर्ष</label>
                <input type="number" data-control="PanchangYear" value="2055">
            </div>
        </div>

        <div id="dynamicControls"></div>

        <div id="planetControls"></div>

        <h2 style="margin-top: 15px; border-bottom: 1px solid #455A64; padding-bottom: 10px;">राशी रत्न (Gemstone)</h2>
        <div id="ratnaControl"></div>

        <h2 style="margin-top: 15px; border-bottom: 1px solid #455A64; padding-bottom: 10px;">महादशा (Page 2)</h2>
        <div class="form-group">
            <label>ग्रह (Planet)</label>
            <select id="dashaPlanetInput">
                <option value="सूर्य">सूर्य</option><option value="चन्द्र">चन्द्र</option><option value="मंगल">मंगल</option>
                <option value="बुध" selected>बुध</option><option value="गुरु">गुरु</option><option value="शुक्र">शुक्र</option>
                <option value="शनि">शनि</option><option value="राहू">राहू</option><option value="केतु">केतु</option>
            </select>
        </div>
        <div class="form-group"><label>सुरुवात (Start Date)</label><input type="date" id="dashaStartInput"></div>
        <div class="form-group"><label>शेवट (End Date)</label><input type="date" id="dashaEndInput"></div>
        
        <button class="btn-add" onclick="addDashaRow()">+ जोडा (Add Dasha)</button>
        <button class="btn-undo" onclick="removeLastDashaRow()">- शेवटची ओळ काढा</button>
        <button class="btn-clear" onclick="clearDashaRows()">सर्व काढा</button>

        <h2 style="margin-top: 15px; border-bottom: 1px solid #455A64; padding-bottom: 10px;">शांती पूजन</h2>
        <div class="checkbox-list" id="poojaChecklist">
        </div>

        <h2 style="margin-top: 15px; border-bottom: 1px solid #455A64; padding-bottom: 10px;">मंत्र उपासना</h2>
        <div class="checkbox-list" id="mantraChecklist">
        </div>

        <h2 style="margin-top: 15px; border-bottom: 1px solid #455A64; padding-bottom: 10px;">फलश्रुती (Page 3)</h2>
        <div class="form-group">
            <label>येथे टाईप करा (Type here):</label>
            <textarea id="falaShrutiSidebarInput" placeholder="येथे फलश्रुती टाईप करा..."></textarea>
        </div>

        <button class="print-btn" onclick="window.print()">Print / Save PDF</button>
    </aside>

    <main class="main-workspace">
        
        <div class="page-container">
            <header class="page-header">
                <img class="logo" src="./assets/Logos/SwaminiLogo.png" alt="">
                <div class="header-contact">
                    <div class="logo-area" style="color: #F47A20;">स्वामिनी ज्योतिष कार्यालय</div>
                    <div class="contact-details">
                        <strong>ज्योतिष: योगेश उंबरकर</strong><br>
                        <strong>मो.:</strong> 9850254914 | <strong>ईमेल:</strong> swaminijyotishkendra@gmail.com
                    </div>
                </div>
                    <div class="header-title">
                    <h1 class="main-heading">कुंडली <span class="client-name-bind">Amey Hatekar</span></h1>
                </div>
            </header>

            <div class="box info-box">
                <div class="info-row-1">
                    नाम: <strong class="client-name-bind">Amey Hatekar</strong> 
                    स्थान: <strong id="infoPlaceDisplay">Amravati, India</strong> (Lat: <span id="latDisplay">20.93</span> , Lon: <span id="lonDisplay">77.75</span>)
                </div>
                <div class="info-row-2" id="infoDateTimeDisplay">
                    25 एप्रि 1998, शनिवार, 09:09 AM
                </div>
            </div>

            <div class="box summary-box">
                <div class="summary-item">
                    <div class="rashi-title">राशि ♓ <span data-bind="Rashi">मीन</span></div>
                    <div class="lagna-title">लग्न ♊ <span data-bind="Lagna">मिथुन</span></div>
                </div>
                <div class="summary-item summary-center">
                    <h3>नाम <span id="naamAksharDisplay">दो..</span></h3>
                    <p>दशा भोग्य <span id="bhogyaPlanetDisplay">बुध</span> <span id="bhogyaYDisplay">10</span>y <span id="bhogyaMDisplay">3</span>m <span id="bhogyaDDisplay">13</span>d</p>
                </div>
                <div class="summary-item">
                    <span id="mangalDoshDisplay" class="mangal-dosh" style="color: var(--text-dark);">मंगळ दोष नाही</span>
                </div>
            </div>

            <div class="details-grid">
                <div class="box detail-card">
                    <table class="detail-table">
                        <tr><td>राशि स्वामी</td><td data-bind="RashiSwami">गुरु</td></tr>
                        <tr><td>नक्षत्र स्वामी</td><td data-bind="NakshatraSwami">बुध</td></tr>
                        <tr><td>नक्षत्र पाया</td><td data-bind="NakshtraPaya">सुवर्ण</td></tr>
                        <tr><td>योनि</td><td data-bind="Yoni">गज</td></tr>
                        <tr><td>गण</td><td data-bind="Gan">देव</td></tr>
                        <tr><td>नाडी</td><td data-bind="Naadi">अन्त्य (कफ)</td></tr>
                        <tr><td>वर्ण</td><td data-bind="Varna">ब्राह्मण</td></tr>
                    </table>
                </div>
                <div class="box detail-card">
                    <table class="detail-table">
                        <tr><td>तिथि</td><td data-bind="Tithi">चतुर्दशी, कृष्ण</td></tr>
                        <tr><td>नक्षत्र, पद</td><td data-bind="NakshatraPada">रेवती 2 दो</td></tr>
                        <tr><td>योग</td><td data-bind="Yog">विष्कुम्भ</td></tr>
                        <tr><td>करण</td><td data-bind="Karan">विष्टि भद्र</td></tr>
                        <tr><td>इष्टकाल</td><td data-bind="IshtKaal">08:07:05</td></tr>
                        <tr><td>सूर्योदय</td><td data-bind="Suryoday">05:54</td></tr>
                        <tr><td></td><td><span data-bind="PanchangDay">शनिवार</span>, <span data-bind="PanchangMonth">चैत्र</span>, <span data-bind="PanchangYear">2055</span> विक्रम संवत</td></tr>
                    </table>
                </div>
            </div>

            <div class="box main-content">
                <div class="chart-container">
                    <svg class="svg-chart" viewBox="0 0 300 300" preserveAspectRatio="xMidYMid meet">
                        <rect x="0" y="0" width="300" height="300" class="chart-lines"/>
                        <line x1="0" y1="0" x2="300" y2="300" class="chart-lines"/>
                        <line x1="300" y1="0" x2="0" y2="300" class="chart-lines"/>
                        <polygon points="150,0 300,150 150,300 0,150" class="chart-lines"/>
                        
                        <text x="150" y="25" text-anchor="middle" class="chart-num">3</text>  <text x="65" y="25" text-anchor="middle" class="chart-num">4</text>   <text x="25" y="65" text-anchor="middle" class="chart-num">5</text>   <text x="40" y="155" text-anchor="middle" class="chart-num">6</text>  <text x="25" y="245" text-anchor="middle" class="chart-num">7</text>  <text x="65" y="285" text-anchor="middle" class="chart-num">8</text>  <text x="150" y="285" text-anchor="middle" class="chart-num">9</text> <text x="235" y="285" text-anchor="middle" class="chart-num">10</text> <text x="275" y="245" text-anchor="middle" class="chart-num">11</text> <text x="260" y="155" text-anchor="middle" class="chart-num">12</text> <text x="275" y="65" text-anchor="middle" class="chart-num">1</text>  <text x="235" y="25" text-anchor="middle" class="chart-num">2</text>  <g id="chart-planets-container">
                            </g>
                    </svg>
                </div>

                <div class="planet-table-section">
                    <h3>लग्न कुंडली</h3>
                    <table class="planet-table">
                        <tr><th>ग्रह</th><th>राशि निरायण</th><th>अंश, कला</th></tr>
                        <tr><td><span class="planet-dot dot-sun"></span> सूर्य<span class="planet-suffix" data-suffix="सूर्य"></span></td><td data-bind="Rashi_सूर्य">♈ मेष</td><td data-bind="Deg_सूर्य">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-moon"></span> चन्द्र<span class="planet-suffix" data-suffix="चन्द्र"></span></td><td data-bind="Rashi_चन्द्र">♓ मीन</td><td data-bind="Deg_चन्द्र">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-mars"></span> मंगल<span class="planet-suffix" data-suffix="मंगल"></span></td><td data-bind="Rashi_मंगल">♈ मेष</td><td data-bind="Deg_मंगल">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-merc"></span> बुध<span class="planet-suffix" data-suffix="बुध"></span></td><td data-bind="Rashi_बुध">♓ मीन</td><td data-bind="Deg_बुध">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-jup"></span> गुरु<span class="planet-suffix" data-suffix="गुरु"></span></td><td data-bind="Rashi_गुरु">♒ कुम्भ</td><td data-bind="Deg_गुरु">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-ven"></span> शुक्र<span class="planet-suffix" data-suffix="शुक्र"></span></td><td data-bind="Rashi_शुक्र">♒ कुम्भ</td><td data-bind="Deg_शुक्र">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-sat"></span> शनि<span class="planet-suffix" data-suffix="शनि"></span></td><td data-bind="Rashi_शनि">♈ मेष</td><td data-bind="Deg_शनि">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-node">☊</span> राहू<span class="planet-suffix" data-suffix="राहू"></span></td><td data-bind="Rashi_राहू">♌ सिंह</td><td data-bind="Deg_राहू">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-node">☋</span> केतु<span class="planet-suffix" data-suffix="केतु"></span></td><td data-bind="Rashi_केतु">♒ कुम्भ</td><td data-bind="Deg_केतु">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-node">♅</span> हर्शल<span class="planet-suffix" data-suffix="हर्शल"></span></td><td data-bind="Rashi_हर्शल">♒ कुम्भ</td><td data-bind="Deg_हर्शल">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-node">♆</span> नेपच्यून<span class="planet-suffix" data-suffix="नेपच्यून"></span></td><td data-bind="Rashi_नेपच्यून">♑ मकर</td><td data-bind="Deg_नेपच्यून">00° 00'</td></tr>
                        <tr><td><span class="planet-dot dot-node">♇</span> प्लूटो<span class="planet-suffix" data-suffix="प्लूटो"></span></td><td data-bind="Rashi_प्लूटो">♐ धनु</td><td data-bind="Deg_प्लूटो">00° 00'</td></tr>
                    </table>
                </div>
            </div>
            <footer class="page-footer">
                Made with ❤️ by <a href="https://orconix.vercel.app/"><img src="./assets/Logos/OrconixLogo.png" alt="Orconix Logo" class="footer-logo"> <span class="orconix-text">Orconix</span></a>
            </footer>
        </div>

        <div class="page-container page-2">
            <header class="page-header">
                <img class="logo" src="./assets/Logos/SwaminiLogo.png" alt="">
                <div class="header-contact">
                    <div class="logo-area" style="color: #F47A20;">स्वामिनी ज्योतिष कार्यालय</div>
                    <div class="contact-details">
                        <strong>ज्योतिष: योगेश उंबरकर</strong><br>
                        <strong>मो.:</strong> 9850254914 | <strong>ईमेल:</strong> swaminijyotishkendra@gmail.com
                    </div>
                </div>
                <div class="header-title">
                    <h1 class="main-heading">महादशा व पूजन &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h1>
                </div>
            </header>

            <div id="page2Grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;">
                
                <div class="box" style="padding: 0; overflow: hidden;">
                    <h3 class="page-2-header">विंशोत्तरी महादशा</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tbody id="dashaTableBody"></tbody>
                    </table>
                </div>

                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div class="box ratna-box">
                        <h3 style="color: var(--primary-blue); margin-top: 0; margin-bottom: 8px; font-size: 18px;">तुमच्यासाठी उपयुक्त रत्न</h3>
                        <div style="font-size: 20px; font-weight: bold; color: var(--accent-green); line-height: 1.3;" data-bind="RashiRatna">
                            मूंगा (Red Coral)
                        </div>
                    </div>

                    <div class="box" id="poojaBox" style="padding: 0; overflow: hidden; display: none;">
                        <h3 class="page-2-header" style="background-color: #F47A20;">आवश्यक शांती पूजन</h3>
                        <div id="poojaGrid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px 15px; padding: 12px 15px;">
                        </div>
                    </div>
                </div>
            </div>

            <div class="box" id="mantraBox" style="padding: 0; overflow: hidden; margin-top: 15px; display: none;">
                <h3 class="page-2-header" style="background-color: #187A22;">मंत्र उपासना</h3>
                <div style="padding: 8px 15px; font-size: 12px; color: var(--text-dark); background: #fdfdfd; border-bottom: 1px solid var(--border-color); line-height: 1.4;">
                    <strong style="color: var(--primary-blue);">टिप :</strong> खाली दिलेले मंत्र हे कोणत्याही महिन्याच्या अमावश्ये नंतर त्या त्या ग्रहाच्या ठराविक दिवसा पासून सुरु करू शकता, त्याकरिता रुद्राक्ष जपमाळ, तांब्याचा दिवा त्या मध्ये शुद्ध गायचे तूप इत्यादी साहित्य आवश्यक आहे.
                </div>
                <table style="width: 100%; border-collapse: collapse;">
                    <tbody id="mantraTableBody"></tbody>
                </table>
            </div>
            <footer class="page-footer">
Made with ❤️ by <a href="https://orconix.vercel.app/"><img src="./assets/Logos/OrconixLogo.png" alt="Orconix Logo" class="footer-logo"> <span class="orconix-text">Orconix</span></a>            </footer>
        </div>

        <div class="page-container page-3">
            <header class="page-header">
                <img class="logo" src="./assets/Logos/SwaminiLogo.png" alt="">
                <div class="header-contact">
                    <div class="logo-area" style="color: #F47A20;">स्वामिनी ज्योतिष कार्यालय</div>
                    <div class="contact-details">
                        <strong>ज्योतिष: योगेश उंबरकर</strong><br>
                        <strong>मो.:</strong> 9850254914 | <strong>ईमेल:</strong> swaminijyotishkendra@gmail.com
                    </div>
                </div>
                <div class="header-title">
                    <h1 class="main-heading">फलश्रुती &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h1>
                </div>
            </header>

            <div class="box" style="padding: 0;">
                <div id="falaShrutiDisplay" class="editable-textarea" contenteditable="true" spellcheck="false" data-placeholder="येथे फलश्रुती टाईप करा (Click here to type)..."></div>
            </div>
            <footer class="page-footer">
Made with ❤️ by <a href="https://orconix.vercel.app/"><img src="./assets/Logos/OrconixLogo.png" alt="Orconix Logo" class="footer-logo"> <span class="orconix-text">Orconix</span></a>            </footer>
        </div>

    </main>

    <script>
        // --- Number Conversion Utility (Force English Digits) ---
        const toEnglishDigits = str => {
            const map = {'०':'0','१':'1','२':'2','३':'3','४':'4','५':'5','६':'6','७':'7','८':'8','९':'9'};
            return str.replace(/[०-९]/g, m => map[m]);
        };

        // --- Core Application Data ---
        const rashiMap = {"मेष": 1, "वृषभ": 2, "मिथुन": 3, "कर्क": 4, "सिंह": 5, "कन्या": 6, "तुला": 7, "वृश्चिक": 8, "धनु": 9, "मकर": 10, "कुंभ": 11, "मीन": 12};
        const rashiSymbols = ["♈ मेष", "♉ वृषभ", "♊ मिथुन", "♋ कर्क", "♌ सिंह", "♍ कन्या", "♎ तुला", "♏ वृश्चिक", "♐ धनु", "♑ मकर", "♒ कुंभ", "♓ मीन"];
        const planetsList = [
            { id: "सूर्य", default: "♈ मेष" }, { id: "चन्द्र", default: "♓ मीन" }, { id: "मंगल", default: "♈ मेष" },
            { id: "बुध", default: "♓ मीन" }, { id: "गुरु", default: "♒ कुम्भ" }, { id: "शुक्र", default: "♒ कुम्भ" },
            { id: "शनि", default: "♈ मेष" }, { id: "राहू", default: "♌ सिंह" }, { id: "केतु", default: "♒ कुम्भ" },
            { id: "हर्शल", default: "♒ कुम्भ" }, { id: "नेपच्यून", default: "♑ मकर" }, { id: "प्लूटो", default: "♐ धनु" }
        ];
        const houseCoords = {
            1: {x: 150, y: 75}, 2: {x: 75, y: 45}, 3: {x: 45, y: 95}, 4: {x: 80, y: 155},
            5: {x: 45, y: 215}, 6: {x: 75, y: 265}, 7: {x: 150, y: 230}, 8: {x: 225, y: 265},
            9: {x: 255, y: 215}, 10: {x: 220, y: 155}, 11: {x: 255, y: 95}, 12: {x: 225, y: 45}
        };

        // --- SVG Chart Master Update Function ---
        function updateChart() {
            const lagnaSelect = document.querySelector('[data-control="Lagna"]');
            if(!lagnaSelect) return;
            
            // 1. Update House Numbers based on Lagna
            let lagnaNum = rashiMap[lagnaSelect.value];
            const numElements = document.querySelectorAll('.chart-num');
            numElements.forEach((el, index) => {
                let num = lagnaNum + index;
                if(num > 12) num -= 12;
                el.textContent = num;
            });

            // 2. Gather Planets based on Rashi & Calculate House
            let houses = { 1:[], 2:[], 3:[], 4:[], 5:[], 6:[], 7:[], 8:[], 9:[], 10:[], 11:[], 12:[] };
            
            // Always put 'लग्न' at the top of house 1
            houses[1].push('लग्न');

            planetsList.forEach(p => {
                const rashiSelect = document.querySelector(`[data-control="Rashi_${p.id}"]`);
                if(!rashiSelect) return;
                
                // Extract pure Rashi name without the Symbol (e.g., "♈ मेष" -> "मेष")
                let pureRashiName = rashiSelect.value.split(" ")[1] || rashiSelect.value;
                if(pureRashiName === "कुम्भ") pureRashiName = "कुंभ"; // Standardize spelling
                
                const rashiNum = rashiMap[pureRashiName];
                if(!rashiNum) return;

                let houseNum = (rashiNum - lagnaNum + 12) % 12 + 1;
                
                const isVakri = document.querySelector(`input[data-vakri="${p.id}"]`)?.checked || false;
                const isAsta = document.querySelector(`input[data-asta="${p.id}"]`)?.checked || false;
                let suffix = "";
                if(isVakri) suffix += "*";
                if(isAsta) suffix += "^";
                
                houses[houseNum].push(p.id + suffix);
            });

            // 3. Render Planet Text Elements inside the SVG
            const container = document.getElementById('chart-planets-container');
            container.innerHTML = ""; // Clear existing planets
            
            for(let h=1; h<=12; h++) {
                if(houses[h].length > 0) {
                    // Group planets by 2 per line for neatness
                    let lines = [];
                    for(let i=0; i<houses[h].length; i+=2) {
                        lines.push(houses[h].slice(i, i+2).join(' '));
                    }
                    
                    let textEl = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    textEl.setAttribute("x", houseCoords[h].x);
                    // Shift starting Y up slightly if there are multiple lines
                    textEl.setAttribute("y", houseCoords[h].y - ((lines.length - 1) * 6)); 
                    textEl.setAttribute("text-anchor", "middle");
                    textEl.setAttribute("class", "chart-planet");
                    
                    lines.forEach((line, index) => {
                        let tspan = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                        tspan.setAttribute("x", houseCoords[h].x);
                        if(index > 0) tspan.setAttribute("dy", "14"); // Line spacing
                        tspan.textContent = line;
                        textEl.appendChild(tspan);
                    });
                    
                    container.appendChild(textEl);
                }
            }
        }

        // --- 1. Header & Basic Info Binding ---
        document.getElementById('clientNameInput').addEventListener('input', e => {
            const val = e.target.value || '______________';
            document.querySelectorAll('.client-name-bind').forEach(el => el.textContent = val);
        });
        
        document.getElementById('clientPlaceInput').addEventListener('input', e => document.getElementById('infoPlaceDisplay').textContent = e.target.value || '______________');
        document.getElementById('clientLatInput').addEventListener('input', e => document.getElementById('latDisplay').textContent = e.target.value || '0.00');
        document.getElementById('clientLonInput').addEventListener('input', e => document.getElementById('lonDisplay').textContent = e.target.value || '0.00');

        const updateDateTime = () => {
            const d = document.getElementById('clientDateInput').value, t = document.getElementById('clientTimeInput').value;
            if(!d) return;
            
            let formattedDate = new Intl.DateTimeFormat('mr-IN', { day: 'numeric', month: 'short', year: 'numeric', weekday: 'long' }).format(new Date(d));
            formattedDate = toEnglishDigits(formattedDate);
            
            let fTime = "";
            if(t) {
                let [h, m] = t.split(':');
                let ampm = h >= 12 ? 'PM' : 'AM';
                h = h % 12 || 12;
                fTime = `, ${h.toString().padStart(2, '0')}:${m} ${ampm}`;
            }
            document.getElementById('infoDateTimeDisplay').textContent = `${formattedDate}${fTime}`;
        };
        document.getElementById('clientDateInput').addEventListener('input', updateDateTime);
        document.getElementById('clientTimeInput').addEventListener('input', updateDateTime);
        updateDateTime();

        // --- Dasha Bhogya & Mangal Dosh Logic ---
        document.getElementById('bhogyaPlanetInput').addEventListener('input', e => document.getElementById('bhogyaPlanetDisplay').textContent = e.target.value);
        document.getElementById('bhogyaYInput').addEventListener('input', e => document.getElementById('bhogyaYDisplay').textContent = e.target.value || '0');
        document.getElementById('bhogyaMInput').addEventListener('input', e => document.getElementById('bhogyaMDisplay').textContent = e.target.value || '0');
        document.getElementById('bhogyaDInput').addEventListener('input', e => document.getElementById('bhogyaDDisplay').textContent = e.target.value || '0');

        document.getElementById('mangalDoshInput').addEventListener('change', e => {
            const display = document.getElementById('mangalDoshDisplay');
            if(e.target.checked) {
                display.textContent = 'मंगळ दोष आहे';
                display.style.color = '#dc3545'; 
            } else {
                display.textContent = 'मंगळ दोष नाही';
                display.style.color = 'var(--text-dark)'; 
            }
        });

        // --- 2. Dynamic Controls Generator ---
        const jyotishData = {
            Lagna: ["मेष", "वृषभ", "मिथुन", "कर्क", "सिंह", "कन्या", "तुला", "वृश्चिक", "धनु", "मकर", "कुंभ", "मीन"],
            Rashi: ["मेष", "वृषभ", "मिथुन", "कर्क", "सिंह", "कन्या", "तुला", "वृश्चिक", "धनु", "मकर", "कुंभ", "मीन"],
            RashiSwami: ["सूर्य", "चंद्र", "मंगळ", "बुध", "गुरु", "शुक्र", "शनि", "राहू", "केतू"],
            NakshatraSwami: ["सूर्य", "चंद्र", "मंगळ", "बुध", "गुरु", "शुक्र", "शनि", "राहू", "केतू"],
            NakshtraPaya: ["सुवर्ण", "रजत", "ताम्र", "लोह"],
            Yoni: ["अश्व", "गज", "मेष", "सर्प", "श्वान", "मार्जार", "मूषक", "गौ", "महिष", "व्याघ्र", "मृग", "वानर", "नकुल", "सिंह"],
            Gan: ["देव", "मनुष्य", "राक्षस"],
            Naadi: ["आद्य (वात)", "मध्य (पित्त)", "अन्त्य (कफ)"],
            Varna: ["ब्राह्मण", "क्षत्रिय", "वैश्य", "शूद्र"],
            Tithi: ["प्रतिपदा", "द्वितीया", "तृतीया", "चतुर्थी", "पंचमी", "षष्ठी", "सप्तमी", "अष्टमी", "नवमी", "दशमी", "एकादशी", "द्वादशी", "त्रयोदशी", "चतुर्दशी", "पौर्णिमा", "अमावास्या"].flatMap(t=>[t+', शुक्ल', t+', कृष्ण']),
            NakshatraPada: [
                ["अश्विनी", ["चू", "चे", "चो", "ला"]], ["भरणी", ["ली", "लू", "ले", "लो"]], ["कृत्तिका", ["अ", "ई", "ऊ", "ए"]],
                ["रोहिणी", ["ओ", "वा", "वी", "वू"]], ["मृगशीर्ष", ["वे", "वो", "का", "की"]], ["आर्द्रा", ["कू", "घ", "ङ", "छ"]],
                ["पुनर्वसु", ["के", "को", "हा", "ही"]], ["पुष्य", ["हू", "हे", "हो", "डा"]], ["आश्लेषा", ["डी", "डू", "डे", "डो"]],
                ["मघा", ["मा", "मी", "मू", "मे"]], ["पूर्वा फाल्गुनी", ["मो", "टा", "टी", "टू"]], ["उत्तरा फाल्गुनी", ["टे", "टो", "पा", "पी"]],
                ["हस्त", ["पू", "ष", "ण", "ठ"]], ["चित्रा", ["पे", "पो", "रा", "री"]], ["स्वाती", ["रू", "रे", "रो", "ता"]],
                ["विशाखा", ["ती", "तू", "ते", "तो"]], ["अनुराधा", ["ना", "नी", "नू", "ने"]], ["ज्येष्ठा", ["नो", "या", "यी", "यू"]],
                ["मूळ", ["ये", "यो", "भा", "भी"]], ["पूर्वाषाढा", ["भू", "धा", "फा", "ढा"]], ["उत्तराषाढा", ["भे", "भो", "जा", "जी"]],
                ["श्रवण", ["खी", "खू", "खे", "खो"]], ["धनिष्ठा", ["गा", "गी", "गू", "गे"]], ["शततारका", ["गो", "सा", "सी", "सू"]],
                ["पूर्वा भाद्रपदा", ["से", "सो", "दा", "दी"]], ["उत्तरा भाद्रपदा", ["दू", "थ", "झ", "ञ"]], ["रेवती", ["दे", "दो", "चा", "ची"]]
            ].flatMap(([n, letters]) => letters.map((l, i) => `${n}, पद ${i + 1} (${l})`)),
            Yog: ["विष्कुंभ", "प्रीति", "आयुष्मान", "सौभाग्य", "शोभन", "अतिगंड", "सुकर्मा", "धृति", "शूल", "गंड", "वृद्धि", "ध्रुव", "व्याघात", "हर्षण", "वज्र", "सिद्धि", "व्यतीपात", "वरीयान", "परिघ", "शिव", "सिद्ध", "साध्य", "शुभ", "शुक्ल", "ब्रह्म", "ऐंद्र", "वैधृति"],
            Karan: ["बव", "बालव", "कौलव", "तैतिल", "गर", "वणिज", "विष्टि (भद्रा)", "शकुनि", "चतुष्पाद", "नाग", "किंस्तुघ्न"]
        };

        const extraTimers = { IshtKaal: { label: "इष्टकाल", type: "time", step: "1" }, Suryoday: { label: "सूर्योदय", type: "time" } };
        
        const ratnaOptions = [
            { label: "मेष (Aries)", stone: "मूंगा (Red Coral)" }, { label: "वृषभ (Taurus)", stone: "पुखराज (Yellow Sapphire)" },
            { label: "मिथुन (Gemini)", stone: "मरकरी / पन्ना (Emerald)" }, { label: "कर्क (Cancer)", stone: "मोती (Pearl)" },
            { label: "सिंह (Leo)", stone: "मूंगा / पुखराज (Red Coral / Yellow Sapphire)" }, { label: "कन्या (Virgo)", stone: "पुखराज / नीलम (Yellow Sapphire / Blue Sapphire)" },
            { label: "तुला (Libra)", stone: "हीरा (Diamond)" }, { label: "वृश्चिक (Scorpio)", stone: "पुखराज / नीलम (Yellow Sapphire / Blue Sapphire)" },
            { label: "धनु (Sagittarius)", stone: "पुखराज (Yellow Sapphire)" }, { label: "मकर (Capricorn)", stone: "नीलम (Blue Sapphire)" },
            { label: "कुंभ (Aquarius)", stone: "नीलम (Blue Sapphire)" }, { label: "मीन (Pisces)", stone: "पुखराज (Yellow Sapphire)" }
        ];

        const poojaList = [
            "🔴 नवग्रह शांती", "📿 गुरु शांती", "🪐 मंगळ दोष शांती", "⚫ शनि शांती", "🌑 राहु-केतु शांती",
            "🐍 कालसर्प दोष", "👶 पितृ दोष शांती", "⚪ त्रीपिंडी श्राद्ध", "🟡 चांडाळ योग शांती",
            "🌟 नक्षत्र शांती", "💰 लक्ष्मी शांती", "🔱 महामृत्युंजय जप", "🧭 वास्तु शांती", "🏺 कुंभ विवाह", "🔥 नवचंडी विधान"
        ];

        const mantraData = {
            "सूर्य": { name: "☀️ सूर्य", mantra: "ॐ ह्रां ह्रीं ह्रौं सः सूर्याय नमः", count: "28,000" },
            "चंद्र": { name: "🌙 चंद्र", mantra: "ॐ श्रां श्रीं श्रौं सः चन्द्राय नमः", count: "44,000" },
            "मंगळ": { name: "♂️ मंगळ", mantra: "ॐ क्रां क्रीं क्रौं सः भौमाय नमः", count: "40,000" },
            "बुध": { name: "☿️ बुध", mantra: "ॐ ब्रां ब्रीं ब्रौं सः बुधाय नमः", count: "36,000" },
            "गुरु": { name: "♃ गुरु", mantra: "ॐ ग्रां ग्रीं ग्रौं सः गुरवे नमः", count: "76,000" },
            "शुक्र": { name: "♀️ शुक्र", mantra: "ॐ द्रां द्रीं द्रौं सः शुक्राय नमः", count: "64,000" },
            "शनि": { name: "♄ शनि", mantra: "ॐ प्रां प्रीं प्रौं सः शनैश्चराय नमः", count: "92,000" },
            "राहू": { name: "☊ राहू", mantra: "ॐ भ्रां भ्रीं भ्रौं सः राहवे नमः", count: "72,000" },
            "केतु": { name: "☋ केतु", mantra: "ॐ स्रां स्रीं स्रौं सः केतवे नमः", count: "68,000" },
            "महामृत्युंजय": { name: "🕉 महा मृत्युंजय मंत्र", mantra: "ॐ त्र्यंबकं यजामहे सुगन्धिं पुष्टिवर्धनम् ।<br>उर्वारुकमिव बन्धनान्मृत्योर्मुक्षीय मामृतात् ॥", count: "1,35,000" }
        };

        const container = document.getElementById('dynamicControls');
        for (const [key, options] of Object.entries(jyotishData)) {
            let html = `<div class="form-group"><label>${key}</label><select data-control="${key}">`;
            options.forEach(opt => html += `<option value="${opt}">${opt}</option>`);
            html += `</select></div>`;
            container.insertAdjacentHTML('beforeend', html);
        }
        for (const [key, attrs] of Object.entries(extraTimers)) {
            let stepAttr = attrs.step ? `step="${attrs.step}"` : "";
            container.insertAdjacentHTML('beforeend', `<div class="form-group"><label>${attrs.label}</label><input type="${attrs.type}" data-control="${key}" ${stepAttr} value="00:00${attrs.step ? ':00' : ''}"></div>`);
        }
        
        // COMPACT PLANET & DEGREE GENERATOR WITH VAKRI/ASTA
        const planetContainer = document.getElementById('planetControls');
        planetContainer.insertAdjacentHTML('beforeend', '<h2 style="margin-top: 25px; border-bottom: 1px solid #455A64; padding-bottom: 10px;">ग्रह स्थिती आणि अंश</h2>');
        planetContainer.insertAdjacentHTML('beforeend', `
            <div style="display: flex; gap: 8px; margin-bottom: 5px; font-size: 12px; color: #B0BEC5;">
                <div style="width: 55px;">ग्रह</div>
                <div style="flex: 1;">राशी</div>
                <div style="width: 65px;">अंश, कला</div>
            </div>
        `);
        
        planetsList.forEach(p => {
            let html = `<div style="margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #3e4f5e;">`;
            
            // Row 1: Planet, Rashi Select, Degree Input
            html += `<div style="display: flex; gap: 8px; align-items: center; margin-bottom: 5px;">`;
            html += `<div style="width: 55px; font-size: 14px;">${p.id}</div>`;
            
            html += `<select data-control="Rashi_${p.id}" style="flex: 1; padding: 6px; border: 1px solid #455A64; border-radius: 4px; background-color: #34495E; color: white; font-size: 14px;">`;
            rashiSymbols.forEach(opt => html += `<option value="${opt}" ${opt === p.default ? 'selected' : ''}>${opt}</option>`);
            html += `</select>`;
            
            html += `<input type="text" data-control="Deg_${p.id}" value="00° 00'" placeholder="00° 00'" style="width: 65px; padding: 6px; border: 1px solid #455A64; border-radius: 4px; background-color: #34495E; color: white; font-size: 14px; text-align: center;">`;
            html += `</div>`;
            
            // Row 2: Vakri & Asta Checkboxes
            html += `<div style="display: flex; gap: 15px; margin-left: 63px;">`;
            html += `<label class="checkbox-item" style="font-size: 12px; margin:0;"><input type="checkbox" data-vakri="${p.id}"> वक्रि (*)</label>`;
            html += `<label class="checkbox-item" style="font-size: 12px; margin:0;"><input type="checkbox" data-asta="${p.id}"> अस्त (^)</label>`;
            html += `</div>`;
            
            html += `</div>`;
            planetContainer.insertAdjacentHTML('beforeend', html);
        });

        const ratnaContainer = document.getElementById('ratnaControl');
        let ratnaHtml = `<div class="form-group"><label>रत्न निवडा (Select Gemstone)</label><select data-control="RashiRatna">`;
        ratnaOptions.forEach(opt => ratnaHtml += `<option value="${opt.stone}">${opt.label} - ${opt.stone}</option>`);
        ratnaHtml += `</select></div>`;
        ratnaContainer.innerHTML = ratnaHtml;

        const poojaChecklistContainer = document.getElementById('poojaChecklist');
        poojaList.forEach((pooja, i) => {
            poojaChecklistContainer.insertAdjacentHTML('beforeend', `
                <label class="checkbox-item"><input type="checkbox" value="${pooja}" onchange="renderPoojaTable()"> ${pooja}</label>
            `);
        });

        const mantraChecklistContainer = document.getElementById('mantraChecklist');
        Object.keys(mantraData).forEach((key, i) => {
            mantraChecklistContainer.insertAdjacentHTML('beforeend', `
                <label class="checkbox-item"><input type="checkbox" value="${key}" onchange="renderMantraTable()"> ${mantraData[key].name}</label>
            `);
        });

        // Global Event Listeners
        document.body.addEventListener('input', (e) => {
            // Text and Select inputs
            if(e.target.dataset.control) {
                const val = e.target.value;
                document.querySelectorAll(`[data-bind="${e.target.dataset.control}"]`).forEach(el => el.textContent = val);
                
                if(e.target.dataset.control === 'NakshatraPada') {
                    const match = val.match(/\(([^)]+)\)/);
                    if (match && match[1]) document.getElementById('naamAksharDisplay').textContent = match[1] + "..";
                }
                
                // Triggers the chart rotation on Lagna or Rashi changes
                if(e.target.dataset.control === 'Lagna' || e.target.dataset.control.startsWith('Rashi_')) {
                    updateChart();
                }
            }
        });

        // Global Change Listener specifically for Vakri/Asta checkboxes
        document.body.addEventListener('change', (e) => {
            if(e.target.dataset.vakri || e.target.dataset.asta) {
                const pId = e.target.dataset.vakri || e.target.dataset.asta;
                const isVakri = document.querySelector(`input[data-vakri="${pId}"]`).checked;
                const isAsta = document.querySelector(`input[data-asta="${pId}"]`).checked;
                
                let suffix = "";
                if(isVakri) suffix += "*";
                if(isAsta) suffix += "^";
                
                document.querySelectorAll(`[data-suffix="${pId}"]`).forEach(el => el.textContent = suffix);
                
                // Trigger chart update so the * or ^ shows up in the SVG too!
                updateChart();
            }
        });

        // Fire initial inputs to populate bindings & trigger rotation
        document.querySelectorAll('[data-control]').forEach(input => input.dispatchEvent(new Event('input', { bubbles: true })));
        
        // Initial chart draw
        updateChart();

        // --- 3. DASHA ROW GENERATOR ---
        function formatDashaDate(dateString) {
            if(!dateString) return "";
            let formatted = new Intl.DateTimeFormat('mr-IN', { day: '2-digit', month: 'short', year: 'numeric' }).format(new Date(dateString));
            return toEnglishDigits(formatted);
        }

        function addDashaRow() {
            const planet = document.getElementById('dashaPlanetInput').value;
            const startDate = document.getElementById('dashaStartInput').value;
            const endDate = document.getElementById('dashaEndInput').value;
            if(!startDate || !endDate) { alert("कृपया सुरुवात आणि शेवटची तारीख निवडा"); return; }

            const tbody = document.getElementById('dashaTableBody');
            tbody.insertAdjacentHTML('beforeend', `
                <tr class="dasha-row">
                    <td>${planet}</td>
                    <td>${formatDashaDate(startDate)} - ${formatDashaDate(endDate)}</td>
                </tr>
            `);
        }
        function removeLastDashaRow() {
            const tbody = document.getElementById('dashaTableBody');
            if (tbody.lastElementChild) tbody.removeChild(tbody.lastElementChild);
        }
        function clearDashaRows() { document.getElementById('dashaTableBody').innerHTML = ""; }

        // --- 4. POOJA CHECKLIST RENDERER ---
        function renderPoojaTable() {
            const poojaGrid = document.getElementById('poojaGrid');
            const poojaBox = document.getElementById('poojaBox');
            poojaGrid.innerHTML = "";
            const checkedBoxes = poojaChecklistContainer.querySelectorAll('input:checked');
            
            if(checkedBoxes.length === 0) {
                poojaBox.style.display = "none";
            } else {
                poojaBox.style.display = "block";
                checkedBoxes.forEach(cb => {
                    poojaGrid.insertAdjacentHTML('beforeend', `
                        <div style="font-size: 14px; font-weight: 600; color: var(--text-dark); padding: 4px 0; border-bottom: 1px dashed #D3D9DE;">
                            ${cb.value}
                        </div>
                    `);
                });
            }
        }

        // --- 5. MANTRA CHECKLIST RENDERER ---
        function renderMantraTable() {
            const tbody = document.getElementById('mantraTableBody');
            const mantraBox = document.getElementById('mantraBox');
            tbody.innerHTML = "";
            const checkedBoxes = mantraChecklistContainer.querySelectorAll('input:checked');

            if(checkedBoxes.length === 0) {
                mantraBox.style.display = "none";
            } else {
                mantraBox.style.display = "block";
                checkedBoxes.forEach(cb => {
                    const data = mantraData[cb.value];
                    tbody.insertAdjacentHTML('beforeend', `
                        <tr class="dasha-row mantra-row">
                            <td>${data.name}</td>
                            <td>${data.mantra}</td>
                            <td>जप: <strong>${data.count}</strong></td>
                        </tr>
                    `);
                });
            }
        }

        // --- 6. FALA SHRUTI BIDIRECTIONAL SYNC ---
        const falaSidebarInput = document.getElementById('falaShrutiSidebarInput');
        const falaDisplay = document.getElementById('falaShrutiDisplay');

        falaSidebarInput.addEventListener('input', (e) => { falaDisplay.innerText = e.target.value; });
        falaDisplay.addEventListener('input', (e) => { falaSidebarInput.value = e.target.innerText; });
    </script>
</body>
</html>